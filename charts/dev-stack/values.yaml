ort-server:
  database:
    host: dev-dev-postgres
    name: ortserver
    schema: public
    username: ortserver
    password: ortpassword
    sslMode: disable
  transport:
    rabbitmq:
      enabled: true
      serverUri: amqp://dev-dev-rabbitmq:5672
      username: ortserver
      password: ortpassword
  core:
    keycloak:
      jwtUri: http://dev-dev-keycloak:8080/realms/ort-server/protocol/openid-connect/certs
      jwtIssuer: http://localhost:8080/realms/ort-server
      accessTokenUrl: http://dev-dev-keycloak:8080/realms/ort-server/protocol/openid-connect/token
      apiUrl: http://dev-dev-keycloak:8080/admin/realms/ort-server
      apiUser: ""
      apiSecret: ortserver-api-access
      clientId: api-access
      subjectClientId: ort-server
    extraVolumes:
      - name: secrets
        persistentVolumeClaim:
          claimName: secrets-pvc
    extraVolumeMounts:
      - name: secrets
        mountPath: /mnt/secrets
  advisor:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  analyzer:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  config:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  evaluator:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  reporter:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  scanner:
    mountPvcs: secrets-pvc->/mnt/secrets,r
  ui:
    url: http://localhost:8082
    apiUrl: http://localhost:8081
    authority: http://localhost:8080/realms/ort-server
    clientId: ort-server
  extraObjects:
    # Nodeports
    - apiVersion: v1
      kind: Service
      metadata:
        name: ort-server-core-nodeport
        namespace: "{{ .Release.Namespace }}"
      spec:
        type: NodePort
        selector:
          app: ort-server-core
        ports:
          - name: ort-server-core
            port: 8081
            targetPort: 8080
            nodePort: 31436
    - apiVersion: v1
      kind: Service
      metadata:
        name: ort-server-ui-nodeport
        namespace: "{{ .Release.Namespace }}"
      spec:
        type: NodePort
        selector:
          app: ort-server-ui
        ports:
          - name: ort-server-ui
            port: 8082
            targetPort: 8080
            nodePort: 31437
    # Secrets Storage
    - apiVersion: v1
      kind: PersistentVolume
      metadata:
        name: secrets-pv
      spec:
        capacity:
          storage: 1Mi
        accessModes:
          - ReadWriteMany
        storageClassName: shared-storage
        hostPath:
          path: /mnt/secrets
    - apiVersion: v1
      kind: PersistentVolumeClaim
      metadata:
        name: secrets-pvc
      spec:
        accessModes:
          - ReadWriteMany
        storageClassName: shared-storage
        resources:
          requests:
            storage: 1Mi

dev-postgres:
  auth:
    username: ortserver
    password: ortpassword
  persistence:
    enabled: false
  customUser:
    name: keycloak
    password: keycloak
    database: keycloak
  extraObjects:
    - apiVersion: v1
      kind: Service
      metadata:
        name: dev-postgres-nodeport
        namespace: "{{ .Release.Namespace }}"
      spec:
        type: NodePort
        selector:
          app.kubernetes.io/instance: "{{ .Release.Name }}"
          app.kubernetes.io/name: dev-postgres
        ports:
          - name: postgresql
            port: 5432
            targetPort: 5432
            nodePort: 31432

dev-rabbitmq:
  persistence:
    enabled: false
  definitions:
    enabled: true
    users:
      - name: ortserver
        password: ortpassword
        tags:
          - administrator
    permissions:
      - user: ortserver
        vhost: "/"
        configure: ".*"
        write: ".*"
        read: ".*"
    queues:
      - name: advisor
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: analyzer
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: core
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: evaluator
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: orchestrator
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: reporter
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
      - name: scanner
        vhost: "/"
        durable: true
        auto_delete: false
        arguments:
          x-queue-type: classic
    vhosts:
      - name: "/"
  extraObjects:
    - apiVersion: v1
      kind: Service
      metadata:
        name: dev-rabbitmq-nodeport
        namespace: "{{ .Release.Namespace }}"
      spec:
        type: NodePort
        selector:
          app.kubernetes.io/instance: "{{ .Release.Name }}"
          app.kubernetes.io/name: dev-rabbitmq
        ports:
          - name: rabbitmq
            port: 15672
            targetPort: 15672
            nodePort: 31434

dev-keycloak:
  keycloak:
    adminUser: ortserver
    adminPassword: ortpassword
  persistence:
    enabled: false
  postgres:
    enabled: false
  database:
    type: postgres
    host: dev-dev-postgres.default.svc.cluster.local
    port: "5432"
    name: keycloak
    user: keycloak
    password: keycloak
  realm:
    import: true
    configFile: |
      {
        "realm": "ort-server",
        "enabled": true,
        "clients": [
          {
            "clientId": "ort-server",
            "name": "ort-server",
            "secret": "",
            "redirectUris": [
              "*"
            ],
            "webOrigins": [
              "*"
            ],
            "implicitFlowEnabled": true,
            "directAccessGrantsEnabled": true,
            "publicClient": true,
            "frontchannelLogout": true,
            "defaultClientScopes": [
              "audience",
              "basic",
              "email",
              "profile",
              "roles"
            ]
          },
          {
            "clientId": "api-access",
            "name": "api-access",
            "surrogateAuthRequired": false,
            "enabled": true,
            "alwaysDisplayInConsole": false,
            "clientAuthenticatorType": "client-secret",
            "secret": "ortserver-api-access",
            "redirectUris": [
              "/*"
            ],
            "webOrigins": [
              "/*"
            ],
            "serviceAccountsEnabled": true,
            "publicClient": false,
            "defaultClientScopes": [
              "roles"
            ],
            "optionalClientScopes": [
              "offline_access"
            ]
          }
        ],
        "clientScopes": [
          {
            "name": "audience",
            "protocol": "openid-connect",
            "protocolMappers": [
              {
                "name": "audience",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-audience-mapper",
                "config": {
                  "included.client.audience": "ort-server",
                  "access.token.claim": "true"
                }
              }
            ]
          },
          {
            "name": "basic",
            "description": "OpenID Connect scope for add all basic claims to the token",
            "protocol": "openid-connect",
            "attributes": {
              "include.in.token.scope": "false",
              "display.on.consent.screen": "false"
            },
            "protocolMappers": [
              {
                "name": "auth_time",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usersessionmodel-note-mapper",
                "consentRequired": false,
                "config": {
                  "user.session.note": "AUTH_TIME",
                  "id.token.claim": "true",
                  "introspection.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "auth_time",
                  "jsonType.label": "long"
                }
              },
              {
                "name": "sub",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-sub-mapper",
                "consentRequired": false,
                "config": {
                  "access.token.claim": "true",
                  "introspection.token.claim": "true"
                }
              }
            ]
          },
          {
            "name": "email",
            "description": "OpenID Connect built-in scope: email",
            "protocol": "openid-connect",
            "attributes": {
              "include.in.token.scope": "true",
              "consent.screen.text": "${emailScopeConsentText}",
              "display.on.consent.screen": "true"
            },
            "protocolMappers": [
              {
                "name": "email verified",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-property-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "emailVerified",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "email_verified",
                  "jsonType.label": "boolean"
                }
              },
              {
                "name": "email",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "email",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "email",
                  "jsonType.label": "String"
                }
              }
            ]
          },
          {
            "name": "profile",
            "description": "OpenID Connect built-in scope: profile",
            "protocol": "openid-connect",
            "attributes": {
              "include.in.token.scope": "true",
              "consent.screen.text": "${profileScopeConsentText}",
              "display.on.consent.screen": "true"
            },
            "protocolMappers": [
              {
                "name": "full name",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-full-name-mapper",
                "consentRequired": false,
                "config": {
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true"
                }
              },
              {
                "name": "profile",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "profile",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "profile",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "updated at",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "updatedAt",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "updated_at",
                  "jsonType.label": "long"
                }
              },
              {
                "name": "given name",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "firstName",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "given_name",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "family name",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "lastName",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "family_name",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "zoneinfo",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "zoneinfo",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "zoneinfo",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "locale",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "locale",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "locale",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "middle name",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "middleName",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "middle_name",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "gender",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "gender",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "gender",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "birthdate",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "birthdate",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "birthdate",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "website",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "website",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "website",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "username",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "username",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "preferred_username",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "nickname",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "nickname",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "nickname",
                  "jsonType.label": "String"
                }
              },
              {
                "name": "picture",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-attribute-mapper",
                "consentRequired": false,
                "config": {
                  "introspection.token.claim": "true",
                  "userinfo.token.claim": "true",
                  "user.attribute": "picture",
                  "id.token.claim": "true",
                  "access.token.claim": "true",
                  "claim.name": "picture",
                  "jsonType.label": "String"
                }
              }
            ]
          },
          {
            "name": "roles",
            "protocol": "openid-connect",
            "protocolMappers": [
              {
                "name" : "audience resolve",
                "protocol" : "openid-connect",
                "protocolMapper" : "oidc-audience-resolve-mapper",
                "consentRequired" : false,
                "config" : { }
              },
              {
                "name": "client roles",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-usermodel-client-role-mapper",
                "consentRequired" : false,
                "config": {
                  "introspection.token.claim" : "true",
                  "multivalued": "true",
                  "userinfo.token.claim": "true",
                  "id.token.claim" : "false",
                  "lightweight.claim" : "false",
                  "access.token.claim" : "false",
                  "claim.name": "resource_access.${client_id}.roles",
                  "jsonType.label": "String",
                  "usermodel.clientRoleMapping.clientId": "ort-server"
                }
              },
              {
                "name": "sub",
                "protocol": "openid-connect",
                "protocolMapper": "oidc-sub-mapper",
                "consentRequired": false,
                "config": {
                  "access.token.claim": "true",
                  "introspection.token.claim": "true"
                }
              }
            ]
          }
        ],
        "groups": [
          {
            "name": "SUPERUSERS",
            "path": "/SUPERUSERS",
            "clientRoles": {
              "ort-server": [
                "superuser"
              ]
            }
          }
        ],
        "roles": {
          "client": {
            "ort-server": [
              {
                "name": "superuser",
                "description": "This role is auto-generated, do not edit or remove.",
                "composite": false,
                "clientRole": true
              }
            ]
          }
        },
        "users": [
          {
            "username": "service-account-api-access",
            "enabled": true,
            "totp": false,
            "serviceAccountClientId": "api-access",
            "realmRoles": [
              "default-roles-ort-server"
            ],
            "clientRoles": {
              "realm-management": [
                "manage-users",
                "manage-realm",
                "manage-clients"
              ]
            }
          },
          {
            "username": "ortserver",
            "enabled": true,
            "email": "ortserver@example.org",
            "firstName": "ORT",
            "lastName": "Server",
            "credentials": [
              {
                "type": "password",
                "value": "ortpassword"
              }
            ],
            "groups": [
              "/SUPERUSERS"
            ]
          }
        ]
      }
  extraObjects:
    - apiVersion: v1
      kind: Service
      metadata:
        name: dev-keycloak-nodeport
        namespace: "{{ .Release.Namespace }}"
      spec:
        type: NodePort
        selector:
          app.kubernetes.io/instance: "{{ .Release.Name }}"
          app.kubernetes.io/name: dev-keycloak
        ports:
          - name: keycloak
            port: 8080
            targetPort: 8080
            nodePort: 31435
